<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PokÃ©market - Product</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

<!-- HERO -->
<section class="hero">
    <div class="hero-overlay"></div>

    <header class="top-header">
        <div class="header-inner">
            <div class="logo">
                <h1>PokÃ©market</h1>
                <p>Collect. Buy. Live.</p>
            </div>

            <button class="login-btn">Log in</button>
        </div>
    </header>

    <nav class="category-nav">
        <button class="active">Product</button>
    </nav>
</section>

<!-- MAIN -->
<main class="container">

    <section class="product-page">
        <div class="product-image">
            <img id="product-img" src="" alt="">
        </div>

        <div class="product-info">
            <h2 id="product-name"></h2>

            <p class="product-desc" id="product-desc"></p>

            <p class="price" id="product-price"></p>

            <div class="quantity">
                <label for="qty">Quantity:</label>
                <input type="number" id="qty" value="1" min="1">
            </div>

            <button class="add-cart-btn" onclick="addToCart()">Add to Basket</button>
        </div>
    </section>

    <!-- CART -->
    <section class="cart">
        <h3>ðŸ›’ Basket</h3>
        <ul id="cart-items"></ul>
        <p id="total-price">Total: 0 kr</p>
    </section>

</main>

<script>
// --- Cart functionality ---
let cart = [];

function addToCart() {
    const name = document.getElementById("product-name").textContent;
    const price = parseFloat(document.getElementById("product-price").textContent);
    const qty = parseInt(document.getElementById("qty").value);

    cart.push({ name, price, qty });
    renderCart();
}

function renderCart() {
    const list = document.getElementById("cart-items");
    list.innerHTML = "";
    let total = 0;

    cart.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `${item.name} x${item.qty} - ${(item.price * item.qty).toFixed(2)} kr`;
        list.appendChild(li);
        total += item.price * item.qty;
    });

    document.getElementById("total-price").textContent = "Total: " + total.toFixed(2) + " kr";
}

// --- Fetch product data dynamically ---
document.addEventListener('DOMContentLoaded', () => {
    const productId = window.location.pathname.split("/").pop();

    fetch(`/api/products/${productId}`)
        .then(res => {
            if (!res.ok) throw new Error("Product not found");
            return res.json();
        })
        .then(product => {
            // Replace "200w" with "400w" in image URL
            const highResImageUrl = product.image_url ? product.image_url.replace('200w', '400w') : '';

            document.getElementById("product-img").src = highResImageUrl;
            document.getElementById("product-img").alt = product.name;
            document.getElementById("product-name").textContent = product.name + " - Diamond & Pearl";
            document.getElementById("product-desc").textContent = product.description || "No description available.";
            document.getElementById("product-price").textContent = parseFloat(product.price || 0).toFixed(2);
        })
        .catch(err => {
            console.error(err);
            document.querySelector(".product-page").innerHTML = "<p>Product not found.</p>";
        });
});
</script>
<script>
    document.querySelector('.login-btn').addEventListener('click', ()=> {
        window.location.href = '/login';
    });
</script>
</body>
</html>
